{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.212.0"},"children":{"AmiraLetterScoringStack":{"id":"AmiraLetterScoringStack","path":"AmiraLetterScoringStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.212.0"},"children":{"AmiraLetterScoringRepo":{"id":"AmiraLetterScoringRepo","path":"AmiraLetterScoringStack/AmiraLetterScoringRepo","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.Repository","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringRepo/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.CfnRepository","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECR::Repository","aws:cdk:cloudformation:props":{"imageScanningConfiguration":{"scanOnPush":true},"lifecyclePolicy":{"lifecyclePolicyText":"{\"rules\":[{\"rulePriority\":1,\"description\":\"Keep only 10 most recent images\",\"selection\":{\"tagStatus\":\"any\",\"countType\":\"imageCountMoreThan\",\"countNumber\":10},\"action\":{\"type\":\"expire\"}}]}"},"repositoryName":"amira-letter-scoring"}}}}},"TritonServerRepo":{"id":"TritonServerRepo","path":"AmiraLetterScoringStack/TritonServerRepo","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.Repository","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/TritonServerRepo/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.CfnRepository","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECR::Repository","aws:cdk:cloudformation:props":{"imageScanningConfiguration":{"scanOnPush":true},"lifecyclePolicy":{"lifecyclePolicyText":"{\"rules\":[{\"rulePriority\":1,\"selection\":{\"tagStatus\":\"any\",\"countType\":\"imageCountMoreThan\",\"countNumber\":5},\"action\":{\"type\":\"expire\"}}]}"},"repositoryName":"triton-server"}}}}},"CloudWatchAgentRepo":{"id":"CloudWatchAgentRepo","path":"AmiraLetterScoringStack/CloudWatchAgentRepo","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.Repository","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/CloudWatchAgentRepo/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.CfnRepository","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECR::Repository","aws:cdk:cloudformation:props":{"imageScanningConfiguration":{"scanOnPush":true},"lifecyclePolicy":{"lifecyclePolicyText":"{\"rules\":[{\"rulePriority\":1,\"selection\":{\"tagStatus\":\"any\",\"countType\":\"imageCountMoreThan\",\"countNumber\":5},\"action\":{\"type\":\"expire\"}}]}"},"repositoryName":"cloudwatch-agent"}}}}},"DcgmExporterRepo":{"id":"DcgmExporterRepo","path":"AmiraLetterScoringStack/DcgmExporterRepo","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.Repository","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/DcgmExporterRepo/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.CfnRepository","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECR::Repository","aws:cdk:cloudformation:props":{"imageScanningConfiguration":{"scanOnPush":true},"lifecyclePolicy":{"lifecyclePolicyText":"{\"rules\":[{\"rulePriority\":1,\"selection\":{\"tagStatus\":\"any\",\"countType\":\"imageCountMoreThan\",\"countNumber\":5},\"action\":{\"type\":\"expire\"}}]}"},"repositoryName":"dcgm-exporter"}}}}},"ModelPath":{"id":"ModelPath","path":"AmiraLetterScoringStack/ModelPath","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"IncludeConfidence":{"id":"IncludeConfidence","path":"AmiraLetterScoringStack/IncludeConfidence","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"AudioDir":{"id":"AudioDir","path":"AmiraLetterScoringStack/AudioDir","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"ResultsPrefix":{"id":"ResultsPrefix","path":"AmiraLetterScoringStack/ResultsPrefix","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"NatGatewayCount":{"id":"NatGatewayCount","path":"AmiraLetterScoringStack/NatGatewayCount","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"AthenaDatabase":{"id":"AthenaDatabase","path":"AmiraLetterScoringStack/AthenaDatabase","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"AthenaOutput":{"id":"AthenaOutput","path":"AmiraLetterScoringStack/AthenaOutput","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"AthenaQuery":{"id":"AthenaQuery","path":"AmiraLetterScoringStack/AthenaQuery","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"AudioBucketName":{"id":"AudioBucketName","path":"AmiraLetterScoringStack/AudioBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"AudioPrefix":{"id":"AudioPrefix","path":"AmiraLetterScoringStack/AudioPrefix","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"AmiraLetterScoringVpc":{"id":"AmiraLetterScoringVpc","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Vpc","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPC","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPC","aws:cdk:cloudformation:props":{"cidrBlock":"10.0.0.0/16","enableDnsHostnames":true,"enableDnsSupport":true,"instanceTenancy":"default","tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc"}]}}},"PublicSubnet1":{"id":"PublicSubnet1","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.PublicSubnet","version":"2.212.0","metadata":[]},"children":{"Subnet":{"id":"Subnet","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet1/Subnet","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnet","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Subnet","aws:cdk:cloudformation:props":{"availabilityZone":{"Fn::Select":[0,{"Fn::GetAZs":""}]},"cidrBlock":"10.0.0.0/24","mapPublicIpOnLaunch":true,"tags":[{"key":"aws-cdk:subnet-name","value":"Public"},{"key":"aws-cdk:subnet-type","value":"Public"},{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet1"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}},"Acl":{"id":"Acl","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet1/Acl","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"RouteTable":{"id":"RouteTable","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet1/RouteTable","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRouteTable","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::RouteTable","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet1"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}},"RouteTableAssociation":{"id":"RouteTableAssociation","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet1/RouteTableAssociation","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnetRouteTableAssociation","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SubnetRouteTableAssociation","aws:cdk:cloudformation:props":{"routeTableId":{"Ref":"AmiraLetterScoringVpcPublicSubnet1RouteTableCB80D605"},"subnetId":{"Ref":"AmiraLetterScoringVpcPublicSubnet1Subnet39C1EE11"}}}},"DefaultRoute":{"id":"DefaultRoute","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet1/DefaultRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRoute","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Route","aws:cdk:cloudformation:props":{"destinationCidrBlock":"0.0.0.0/0","gatewayId":{"Ref":"AmiraLetterScoringVpcIGW57A8F92B"},"routeTableId":{"Ref":"AmiraLetterScoringVpcPublicSubnet1RouteTableCB80D605"}}}}}},"PublicSubnet2":{"id":"PublicSubnet2","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.PublicSubnet","version":"2.212.0","metadata":[]},"children":{"Subnet":{"id":"Subnet","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet2/Subnet","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnet","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Subnet","aws:cdk:cloudformation:props":{"availabilityZone":{"Fn::Select":[1,{"Fn::GetAZs":""}]},"cidrBlock":"10.0.1.0/24","mapPublicIpOnLaunch":true,"tags":[{"key":"aws-cdk:subnet-name","value":"Public"},{"key":"aws-cdk:subnet-type","value":"Public"},{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet2"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}},"Acl":{"id":"Acl","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet2/Acl","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"RouteTable":{"id":"RouteTable","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet2/RouteTable","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRouteTable","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::RouteTable","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet2"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}},"RouteTableAssociation":{"id":"RouteTableAssociation","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet2/RouteTableAssociation","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnetRouteTableAssociation","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SubnetRouteTableAssociation","aws:cdk:cloudformation:props":{"routeTableId":{"Ref":"AmiraLetterScoringVpcPublicSubnet2RouteTable0AB3B914"},"subnetId":{"Ref":"AmiraLetterScoringVpcPublicSubnet2Subnet32CF4745"}}}},"DefaultRoute":{"id":"DefaultRoute","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PublicSubnet2/DefaultRoute","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRoute","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Route","aws:cdk:cloudformation:props":{"destinationCidrBlock":"0.0.0.0/0","gatewayId":{"Ref":"AmiraLetterScoringVpcIGW57A8F92B"},"routeTableId":{"Ref":"AmiraLetterScoringVpcPublicSubnet2RouteTable0AB3B914"}}}}}},"PrivateSubnet1":{"id":"PrivateSubnet1","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet1","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.PrivateSubnet","version":"2.212.0","metadata":[]},"children":{"Subnet":{"id":"Subnet","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet1/Subnet","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnet","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Subnet","aws:cdk:cloudformation:props":{"availabilityZone":{"Fn::Select":[0,{"Fn::GetAZs":""}]},"cidrBlock":"10.0.2.0/24","mapPublicIpOnLaunch":false,"tags":[{"key":"aws-cdk:subnet-name","value":"Private"},{"key":"aws-cdk:subnet-type","value":"Private"},{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet1"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}},"Acl":{"id":"Acl","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet1/Acl","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"RouteTable":{"id":"RouteTable","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet1/RouteTable","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRouteTable","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::RouteTable","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet1"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}},"RouteTableAssociation":{"id":"RouteTableAssociation","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet1/RouteTableAssociation","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnetRouteTableAssociation","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SubnetRouteTableAssociation","aws:cdk:cloudformation:props":{"routeTableId":{"Ref":"AmiraLetterScoringVpcPrivateSubnet1RouteTable2FFD8D29"},"subnetId":{"Ref":"AmiraLetterScoringVpcPrivateSubnet1SubnetAFBD66CD"}}}}}},"PrivateSubnet2":{"id":"PrivateSubnet2","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet2","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.PrivateSubnet","version":"2.212.0","metadata":[]},"children":{"Subnet":{"id":"Subnet","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet2/Subnet","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnet","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Subnet","aws:cdk:cloudformation:props":{"availabilityZone":{"Fn::Select":[1,{"Fn::GetAZs":""}]},"cidrBlock":"10.0.3.0/24","mapPublicIpOnLaunch":false,"tags":[{"key":"aws-cdk:subnet-name","value":"Private"},{"key":"aws-cdk:subnet-type","value":"Private"},{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet2"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}},"Acl":{"id":"Acl","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet2/Acl","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"RouteTable":{"id":"RouteTable","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet2/RouteTable","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnRouteTable","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::RouteTable","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet2"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}},"RouteTableAssociation":{"id":"RouteTableAssociation","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/PrivateSubnet2/RouteTableAssociation","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSubnetRouteTableAssociation","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SubnetRouteTableAssociation","aws:cdk:cloudformation:props":{"routeTableId":{"Ref":"AmiraLetterScoringVpcPrivateSubnet2RouteTableAA55AFF2"},"subnetId":{"Ref":"AmiraLetterScoringVpcPrivateSubnet2Subnet12E38A78"}}}}}},"IGW":{"id":"IGW","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/IGW","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInternetGateway","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::InternetGateway","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc"}]}}},"VPCGW":{"id":"VPCGW","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/VPCGW","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPCGatewayAttachment","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPCGatewayAttachment","aws:cdk:cloudformation:props":{"internetGatewayId":{"Ref":"AmiraLetterScoringVpcIGW57A8F92B"},"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}},"RestrictDefaultSecurityGroupCustomResource":{"id":"RestrictDefaultSecurityGroupCustomResource","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/RestrictDefaultSecurityGroupCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.212.0","metadata":[]},"children":{"Default":{"id":"Default","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/RestrictDefaultSecurityGroupCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.212.0"}}}},"S3Endpoint":{"id":"S3Endpoint","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/S3Endpoint","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.GatewayVpcEndpoint","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/S3Endpoint/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPCEndpoint","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPCEndpoint","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc"}],"routeTableIds":[{"Ref":"AmiraLetterScoringVpcPrivateSubnet1RouteTable2FFD8D29"},{"Ref":"AmiraLetterScoringVpcPrivateSubnet2RouteTableAA55AFF2"}],"serviceName":{"Fn::Join":["",["com.amazonaws.",{"Ref":"AWS::Region"},".s3"]]},"vpcEndpointType":"Gateway","vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}}}},"EcrApiEndpoint":{"id":"EcrApiEndpoint","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/EcrApiEndpoint","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.InterfaceVpcEndpoint","version":"2.212.0","metadata":[]},"children":{"SecurityGroup":{"id":"SecurityGroup","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/EcrApiEndpoint/SecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/EcrApiEndpoint/SecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"AmiraLetterScoringStack/AmiraLetterScoringVpc/EcrApiEndpoint/SecurityGroup","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":{"Fn::GetAtt":["AmiraLetterScoringVpc85F626DF","CidrBlock"]},"ipProtocol":"tcp","fromPort":443,"toPort":443,"description":{"Fn::Join":["",["from ",{"Fn::GetAtt":["AmiraLetterScoringVpc85F626DF","CidrBlock"]},":443"]]}}],"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}}}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/EcrApiEndpoint/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPCEndpoint","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPCEndpoint","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc"}],"privateDnsEnabled":true,"securityGroupIds":[{"Fn::GetAtt":["AmiraLetterScoringVpcEcrApiEndpointSecurityGroupEE461FE9","GroupId"]}],"serviceName":"com.amazonaws.us-east-1.ecr.api","subnetIds":[{"Ref":"AmiraLetterScoringVpcPrivateSubnet1SubnetAFBD66CD"},{"Ref":"AmiraLetterScoringVpcPrivateSubnet2Subnet12E38A78"}],"vpcEndpointType":"Interface","vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}}}},"EcrDockerEndpoint":{"id":"EcrDockerEndpoint","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/EcrDockerEndpoint","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.InterfaceVpcEndpoint","version":"2.212.0","metadata":[]},"children":{"SecurityGroup":{"id":"SecurityGroup","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/EcrDockerEndpoint/SecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/EcrDockerEndpoint/SecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"AmiraLetterScoringStack/AmiraLetterScoringVpc/EcrDockerEndpoint/SecurityGroup","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":{"Fn::GetAtt":["AmiraLetterScoringVpc85F626DF","CidrBlock"]},"ipProtocol":"tcp","fromPort":443,"toPort":443,"description":{"Fn::Join":["",["from ",{"Fn::GetAtt":["AmiraLetterScoringVpc85F626DF","CidrBlock"]},":443"]]}}],"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}}}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/EcrDockerEndpoint/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPCEndpoint","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPCEndpoint","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc"}],"privateDnsEnabled":true,"securityGroupIds":[{"Fn::GetAtt":["AmiraLetterScoringVpcEcrDockerEndpointSecurityGroupC70589F1","GroupId"]}],"serviceName":"com.amazonaws.us-east-1.ecr.dkr","subnetIds":[{"Ref":"AmiraLetterScoringVpcPrivateSubnet1SubnetAFBD66CD"},{"Ref":"AmiraLetterScoringVpcPrivateSubnet2Subnet12E38A78"}],"vpcEndpointType":"Interface","vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}}}},"CloudWatchLogsEndpoint":{"id":"CloudWatchLogsEndpoint","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/CloudWatchLogsEndpoint","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.InterfaceVpcEndpoint","version":"2.212.0","metadata":[]},"children":{"SecurityGroup":{"id":"SecurityGroup","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/CloudWatchLogsEndpoint/SecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/CloudWatchLogsEndpoint/SecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"AmiraLetterScoringStack/AmiraLetterScoringVpc/CloudWatchLogsEndpoint/SecurityGroup","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":{"Fn::GetAtt":["AmiraLetterScoringVpc85F626DF","CidrBlock"]},"ipProtocol":"tcp","fromPort":443,"toPort":443,"description":{"Fn::Join":["",["from ",{"Fn::GetAtt":["AmiraLetterScoringVpc85F626DF","CidrBlock"]},":443"]]}}],"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}}}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/CloudWatchLogsEndpoint/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPCEndpoint","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPCEndpoint","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc"}],"privateDnsEnabled":true,"securityGroupIds":[{"Fn::GetAtt":["AmiraLetterScoringVpcCloudWatchLogsEndpointSecurityGroup1B31903A","GroupId"]}],"serviceName":"com.amazonaws.us-east-1.logs","subnetIds":[{"Ref":"AmiraLetterScoringVpcPrivateSubnet1SubnetAFBD66CD"},{"Ref":"AmiraLetterScoringVpcPrivateSubnet2Subnet12E38A78"}],"vpcEndpointType":"Interface","vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}}}},"SqsEndpoint":{"id":"SqsEndpoint","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/SqsEndpoint","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.InterfaceVpcEndpoint","version":"2.212.0","metadata":[]},"children":{"SecurityGroup":{"id":"SecurityGroup","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/SqsEndpoint/SecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/SqsEndpoint/SecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"AmiraLetterScoringStack/AmiraLetterScoringVpc/SqsEndpoint/SecurityGroup","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":{"Fn::GetAtt":["AmiraLetterScoringVpc85F626DF","CidrBlock"]},"ipProtocol":"tcp","fromPort":443,"toPort":443,"description":{"Fn::Join":["",["from ",{"Fn::GetAtt":["AmiraLetterScoringVpc85F626DF","CidrBlock"]},":443"]]}}],"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}}}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringVpc/SqsEndpoint/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnVPCEndpoint","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::VPCEndpoint","aws:cdk:cloudformation:props":{"tags":[{"key":"Name","value":"AmiraLetterScoringStack/AmiraLetterScoringVpc"}],"privateDnsEnabled":true,"securityGroupIds":[{"Fn::GetAtt":["AmiraLetterScoringVpcSqsEndpointSecurityGroupABE6AD9F","GroupId"]}],"serviceName":"com.amazonaws.us-east-1.sqs","subnetIds":[{"Ref":"AmiraLetterScoringVpcPrivateSubnet1SubnetAFBD66CD"},{"Ref":"AmiraLetterScoringVpcPrivateSubnet2Subnet12E38A78"}],"vpcEndpointType":"Interface","vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}}}}}},"Custom::VpcRestrictDefaultSGCustomResourceProvider":{"id":"Custom::VpcRestrictDefaultSGCustomResourceProvider","path":"AmiraLetterScoringStack/Custom::VpcRestrictDefaultSGCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.212.0"},"children":{"Staging":{"id":"Staging","path":"AmiraLetterScoringStack/Custom::VpcRestrictDefaultSGCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.212.0"}},"Role":{"id":"Role","path":"AmiraLetterScoringStack/Custom::VpcRestrictDefaultSGCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.212.0"}},"Handler":{"id":"Handler","path":"AmiraLetterScoringStack/Custom::VpcRestrictDefaultSGCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.212.0"}}}},"AmiraLetterScoringSecurityGroup":{"id":"AmiraLetterScoringSecurityGroup","path":"AmiraLetterScoringStack/AmiraLetterScoringSecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringSecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"Security group for Amira Letter Scoring ECS tasks","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"vpcId":{"Ref":"AmiraLetterScoringVpc85F626DF"}}}}}},"AmiraLetterScoringCluster":{"id":"AmiraLetterScoringCluster","path":"AmiraLetterScoringStack/AmiraLetterScoringCluster","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.Cluster","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringCluster/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnCluster","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::Cluster","aws:cdk:cloudformation:props":{"clusterName":"amira-letter-scoring-cluster","clusterSettings":[{"name":"containerInsights","value":"enabled"}]}}},"AmiraLetterScoringCluster":{"id":"AmiraLetterScoringCluster","path":"AmiraLetterScoringStack/AmiraLetterScoringCluster/AmiraLetterScoringCluster","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnClusterCapacityProviderAssociations","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::ClusterCapacityProviderAssociations","aws:cdk:cloudformation:props":{"capacityProviders":[{"Ref":"GpuCapacityProviderG5xlargeD25A2496"},{"Ref":"GpuCapacityProviderG52xlarge96802DE0"},{"Ref":"GpuCapacityProvider4F6714BE"}],"cluster":{"Ref":"AmiraLetterScoringCluster5CE0BCC9"},"defaultCapacityProviderStrategy":[]}}}}},"GpuInstanceRole":{"id":"GpuInstanceRole","path":"AmiraLetterScoringStack/GpuInstanceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.212.0","metadata":[]},"children":{"ImportGpuInstanceRole":{"id":"ImportGpuInstanceRole","path":"AmiraLetterScoringStack/GpuInstanceRole/ImportGpuInstanceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/GpuInstanceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AmazonEC2ContainerServiceforEC2Role"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonSSMManagedInstanceCore"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AmiraLetterScoringStack/GpuInstanceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/GpuInstanceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ecs:DeregisterContainerInstance","ecs:RegisterContainerInstance","ecs:Submit*"],"Effect":"Allow","Resource":{"Fn::GetAtt":["AmiraLetterScoringCluster5CE0BCC9","Arn"]}},{"Action":["ecs:Poll","ecs:StartTelemetrySession"],"Condition":{"ArnEquals":{"ecs:cluster":{"Fn::GetAtt":["AmiraLetterScoringCluster5CE0BCC9","Arn"]}}},"Effect":"Allow","Resource":"*"},{"Action":["ecr:GetAuthorizationToken","ecs:DiscoverPollEndpoint","logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"GpuInstanceRoleDefaultPolicyC5ED993F","roles":[{"Ref":"GpuInstanceRole141744D4"}]}}}}}}},"GpuLaunchTemplate":{"id":"GpuLaunchTemplate","path":"AmiraLetterScoringStack/GpuLaunchTemplate","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.LaunchTemplate","version":"2.212.0","metadata":[]},"children":{"Profile":{"id":"Profile","path":"AmiraLetterScoringStack/GpuLaunchTemplate/Profile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"GpuInstanceRole141744D4"}]}}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/GpuLaunchTemplate/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnLaunchTemplate","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::LaunchTemplate","aws:cdk:cloudformation:props":{"launchTemplateData":{"iamInstanceProfile":{"arn":{"Fn::GetAtt":["GpuLaunchTemplateProfile2D03B57E","Arn"]}},"imageId":{"Ref":"SsmParameterValueawsserviceecsoptimizedamiamazonlinux2gpurecommendedimageidC96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"g5.4xlarge","instanceMarketOptions":{"marketType":"spot","spotOptions":{"instanceInterruptionBehavior":"stop","spotInstanceType":"one-time"}},"securityGroupIds":[{"Fn::GetAtt":["AmiraLetterScoringSecurityGroup645D2D92","GroupId"]}],"tagSpecifications":[{"resourceType":"instance","tags":[{"key":"Name","value":"AmiraLetterScoringStack/GpuLaunchTemplate"}]},{"resourceType":"volume","tags":[{"key":"Name","value":"AmiraLetterScoringStack/GpuLaunchTemplate"}]}],"userData":{"Fn::Base64":{"Fn::Join":["",["#!/bin/bash\necho ECS_CLUSTER=",{"Ref":"AmiraLetterScoringCluster5CE0BCC9"}," >> /etc/ecs/ecs.config\nsudo iptables --insert FORWARD 1 --in-interface docker+ --destination 169.254.169.254/32 --jump DROP\nsudo service iptables save\necho ECS_AWSVPC_BLOCK_IMDS=true >> /etc/ecs/ecs.config"]]}},"metadataOptions":{"httpTokens":"required"}},"tagSpecifications":[{"resourceType":"launch-template","tags":[{"key":"Name","value":"AmiraLetterScoringStack/GpuLaunchTemplate"}]}]}}}}},"SsmParameterValue:--aws--service--ecs--optimized-ami--amazon-linux-2--gpu--recommended--image_id:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter":{"id":"SsmParameterValue:--aws--service--ecs--optimized-ami--amazon-linux-2--gpu--recommended--image_id:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","path":"AmiraLetterScoringStack/SsmParameterValue:--aws--service--ecs--optimized-ami--amazon-linux-2--gpu--recommended--image_id:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"SsmParameterValue:--aws--service--ecs--optimized-ami--amazon-linux-2--gpu--recommended--image_id:C96584B6-F00A-464E-AD19-53AFF4B05118":{"id":"SsmParameterValue:--aws--service--ecs--optimized-ami--amazon-linux-2--gpu--recommended--image_id:C96584B6-F00A-464E-AD19-53AFF4B05118","path":"AmiraLetterScoringStack/SsmParameterValue:--aws--service--ecs--optimized-ami--amazon-linux-2--gpu--recommended--image_id:C96584B6-F00A-464E-AD19-53AFF4B05118","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"GpuAutoScalingGroup":{"id":"GpuAutoScalingGroup","path":"AmiraLetterScoringStack/GpuAutoScalingGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.AutoScalingGroup","version":"2.212.0","metadata":[]},"children":{"ASG":{"id":"ASG","path":"AmiraLetterScoringStack/GpuAutoScalingGroup/ASG","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.CfnAutoScalingGroup","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AutoScaling::AutoScalingGroup","aws:cdk:cloudformation:props":{"capacityRebalance":true,"desiredCapacity":"0","launchTemplate":{"launchTemplateId":{"Ref":"GpuLaunchTemplateEF2D4048"},"version":{"Fn::GetAtt":["GpuLaunchTemplateEF2D4048","LatestVersionNumber"]}},"maxSize":"10","minSize":"0","newInstancesProtectedFromScaleIn":true,"vpcZoneIdentifier":[{"Ref":"AmiraLetterScoringVpcPrivateSubnet1SubnetAFBD66CD"},{"Ref":"AmiraLetterScoringVpcPrivateSubnet2Subnet12E38A78"}]}}}}},"GpuCapacityProvider":{"id":"GpuCapacityProvider","path":"AmiraLetterScoringStack/GpuCapacityProvider","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.AsgCapacityProvider","version":"2.212.0"},"children":{"GpuCapacityProvider":{"id":"GpuCapacityProvider","path":"AmiraLetterScoringStack/GpuCapacityProvider/GpuCapacityProvider","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnCapacityProvider","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::CapacityProvider","aws:cdk:cloudformation:props":{"autoScalingGroupProvider":{"autoScalingGroupArn":{"Ref":"GpuAutoScalingGroupASG98F60F09"},"managedScaling":{"status":"ENABLED","targetCapacity":100},"managedTerminationProtection":"ENABLED"}}}}}},"GpuLaunchTemplateG5xlarge":{"id":"GpuLaunchTemplateG5xlarge","path":"AmiraLetterScoringStack/GpuLaunchTemplateG5xlarge","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.LaunchTemplate","version":"2.212.0","metadata":[]},"children":{"Profile":{"id":"Profile","path":"AmiraLetterScoringStack/GpuLaunchTemplateG5xlarge/Profile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"GpuInstanceRole141744D4"}]}}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/GpuLaunchTemplateG5xlarge/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnLaunchTemplate","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::LaunchTemplate","aws:cdk:cloudformation:props":{"launchTemplateData":{"iamInstanceProfile":{"arn":{"Fn::GetAtt":["GpuLaunchTemplateG5xlargeProfileE7AF50B4","Arn"]}},"imageId":{"Ref":"SsmParameterValueawsserviceecsoptimizedamiamazonlinux2gpurecommendedimageidC96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"g5.xlarge","instanceMarketOptions":{"marketType":"spot","spotOptions":{"instanceInterruptionBehavior":"stop","spotInstanceType":"one-time"}},"securityGroupIds":[{"Fn::GetAtt":["AmiraLetterScoringSecurityGroup645D2D92","GroupId"]}],"tagSpecifications":[{"resourceType":"instance","tags":[{"key":"Name","value":"AmiraLetterScoringStack/GpuLaunchTemplateG5xlarge"}]},{"resourceType":"volume","tags":[{"key":"Name","value":"AmiraLetterScoringStack/GpuLaunchTemplateG5xlarge"}]}],"userData":{"Fn::Base64":{"Fn::Join":["",["#!/bin/bash\necho ECS_CLUSTER=",{"Ref":"AmiraLetterScoringCluster5CE0BCC9"}," >> /etc/ecs/ecs.config\nsudo iptables --insert FORWARD 1 --in-interface docker+ --destination 169.254.169.254/32 --jump DROP\nsudo service iptables save\necho ECS_AWSVPC_BLOCK_IMDS=true >> /etc/ecs/ecs.config"]]}},"metadataOptions":{"httpTokens":"required"}},"tagSpecifications":[{"resourceType":"launch-template","tags":[{"key":"Name","value":"AmiraLetterScoringStack/GpuLaunchTemplateG5xlarge"}]}]}}}}},"GpuAsgG5xlarge":{"id":"GpuAsgG5xlarge","path":"AmiraLetterScoringStack/GpuAsgG5xlarge","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.AutoScalingGroup","version":"2.212.0","metadata":[]},"children":{"ASG":{"id":"ASG","path":"AmiraLetterScoringStack/GpuAsgG5xlarge/ASG","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.CfnAutoScalingGroup","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AutoScaling::AutoScalingGroup","aws:cdk:cloudformation:props":{"capacityRebalance":true,"desiredCapacity":"0","launchTemplate":{"launchTemplateId":{"Ref":"GpuLaunchTemplateG5xlarge139826E5"},"version":{"Fn::GetAtt":["GpuLaunchTemplateG5xlarge139826E5","LatestVersionNumber"]}},"maxSize":"10","minSize":"0","newInstancesProtectedFromScaleIn":true,"vpcZoneIdentifier":[{"Ref":"AmiraLetterScoringVpcPrivateSubnet1SubnetAFBD66CD"},{"Ref":"AmiraLetterScoringVpcPrivateSubnet2Subnet12E38A78"}]}}}}},"GpuCapacityProviderG5xlarge":{"id":"GpuCapacityProviderG5xlarge","path":"AmiraLetterScoringStack/GpuCapacityProviderG5xlarge","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.AsgCapacityProvider","version":"2.212.0"},"children":{"GpuCapacityProviderG5xlarge":{"id":"GpuCapacityProviderG5xlarge","path":"AmiraLetterScoringStack/GpuCapacityProviderG5xlarge/GpuCapacityProviderG5xlarge","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnCapacityProvider","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::CapacityProvider","aws:cdk:cloudformation:props":{"autoScalingGroupProvider":{"autoScalingGroupArn":{"Ref":"GpuAsgG5xlargeASG242F426D"},"managedScaling":{"status":"ENABLED","targetCapacity":100},"managedTerminationProtection":"ENABLED"}}}}}},"GpuLaunchTemplateG52xlarge":{"id":"GpuLaunchTemplateG52xlarge","path":"AmiraLetterScoringStack/GpuLaunchTemplateG52xlarge","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.LaunchTemplate","version":"2.212.0","metadata":[]},"children":{"Profile":{"id":"Profile","path":"AmiraLetterScoringStack/GpuLaunchTemplateG52xlarge/Profile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"GpuInstanceRole141744D4"}]}}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/GpuLaunchTemplateG52xlarge/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnLaunchTemplate","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::LaunchTemplate","aws:cdk:cloudformation:props":{"launchTemplateData":{"iamInstanceProfile":{"arn":{"Fn::GetAtt":["GpuLaunchTemplateG52xlargeProfile7B3C640B","Arn"]}},"imageId":{"Ref":"SsmParameterValueawsserviceecsoptimizedamiamazonlinux2gpurecommendedimageidC96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"g5.2xlarge","instanceMarketOptions":{"marketType":"spot","spotOptions":{"instanceInterruptionBehavior":"stop","spotInstanceType":"one-time"}},"securityGroupIds":[{"Fn::GetAtt":["AmiraLetterScoringSecurityGroup645D2D92","GroupId"]}],"tagSpecifications":[{"resourceType":"instance","tags":[{"key":"Name","value":"AmiraLetterScoringStack/GpuLaunchTemplateG52xlarge"}]},{"resourceType":"volume","tags":[{"key":"Name","value":"AmiraLetterScoringStack/GpuLaunchTemplateG52xlarge"}]}],"userData":{"Fn::Base64":{"Fn::Join":["",["#!/bin/bash\necho ECS_CLUSTER=",{"Ref":"AmiraLetterScoringCluster5CE0BCC9"}," >> /etc/ecs/ecs.config\nsudo iptables --insert FORWARD 1 --in-interface docker+ --destination 169.254.169.254/32 --jump DROP\nsudo service iptables save\necho ECS_AWSVPC_BLOCK_IMDS=true >> /etc/ecs/ecs.config"]]}},"metadataOptions":{"httpTokens":"required"}},"tagSpecifications":[{"resourceType":"launch-template","tags":[{"key":"Name","value":"AmiraLetterScoringStack/GpuLaunchTemplateG52xlarge"}]}]}}}}},"GpuAsgG52xlarge":{"id":"GpuAsgG52xlarge","path":"AmiraLetterScoringStack/GpuAsgG52xlarge","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.AutoScalingGroup","version":"2.212.0","metadata":[]},"children":{"ASG":{"id":"ASG","path":"AmiraLetterScoringStack/GpuAsgG52xlarge/ASG","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.CfnAutoScalingGroup","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AutoScaling::AutoScalingGroup","aws:cdk:cloudformation:props":{"capacityRebalance":true,"desiredCapacity":"0","launchTemplate":{"launchTemplateId":{"Ref":"GpuLaunchTemplateG52xlarge93DE7D74"},"version":{"Fn::GetAtt":["GpuLaunchTemplateG52xlarge93DE7D74","LatestVersionNumber"]}},"maxSize":"10","minSize":"0","newInstancesProtectedFromScaleIn":true,"vpcZoneIdentifier":[{"Ref":"AmiraLetterScoringVpcPrivateSubnet1SubnetAFBD66CD"},{"Ref":"AmiraLetterScoringVpcPrivateSubnet2Subnet12E38A78"}]}}}}},"GpuCapacityProviderG52xlarge":{"id":"GpuCapacityProviderG52xlarge","path":"AmiraLetterScoringStack/GpuCapacityProviderG52xlarge","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.AsgCapacityProvider","version":"2.212.0"},"children":{"GpuCapacityProviderG52xlarge":{"id":"GpuCapacityProviderG52xlarge","path":"AmiraLetterScoringStack/GpuCapacityProviderG52xlarge/GpuCapacityProviderG52xlarge","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnCapacityProvider","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::CapacityProvider","aws:cdk:cloudformation:props":{"autoScalingGroupProvider":{"autoScalingGroupArn":{"Ref":"GpuAsgG52xlargeASG1CBA2EF7"},"managedScaling":{"status":"ENABLED","targetCapacity":100},"managedTerminationProtection":"ENABLED"}}}}}},"AccessLogsBucket":{"id":"AccessLogsBucket","path":"AmiraLetterScoringStack/AccessLogsBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AccessLogsBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true}}}},"Policy":{"id":"Policy","path":"AmiraLetterScoringStack/AccessLogsBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AccessLogsBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"AccessLogsBucket83982689"},"policyDocument":{"Statement":[{"Action":"s3:*","Condition":{"Bool":{"aws:SecureTransport":"false"}},"Effect":"Deny","Principal":{"AWS":"*"},"Resource":[{"Fn::GetAtt":["AccessLogsBucket83982689","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["AccessLogsBucket83982689","Arn"]},"/*"]]}]},{"Action":"s3:PutObject","Condition":{"ArnLike":{"aws:SourceArn":{"Fn::GetAtt":["ResultsBucketA95A2103","Arn"]}},"StringEquals":{"aws:SourceAccount":{"Ref":"AWS::AccountId"}}},"Effect":"Allow","Principal":{"Service":"logging.s3.amazonaws.com"},"Resource":{"Fn::Join":["",[{"Fn::GetAtt":["AccessLogsBucket83982689","Arn"]},"/s3-access-logs/*"]]}}],"Version":"2012-10-17"}}}}}}}},"ResultsBucketKey":{"id":"ResultsBucketKey","path":"AmiraLetterScoringStack/ResultsBucketKey","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.Key","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ResultsBucketKey/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.CfnKey","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::KMS::Key","aws:cdk:cloudformation:props":{"enableKeyRotation":true,"keyPolicy":{"Statement":[{"Action":"kms:*","Effect":"Allow","Principal":{"AWS":{"Fn::Join":["",["arn:aws:iam::",{"Ref":"AWS::AccountId"},":root"]]}},"Resource":"*"}],"Version":"2012-10-17"}}}},"Alias":{"id":"Alias","path":"AmiraLetterScoringStack/ResultsBucketKey/Alias","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.Alias","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ResultsBucketKey/Alias/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.CfnAlias","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::KMS::Alias","aws:cdk:cloudformation:props":{"aliasName":"alias/amira-letter-scoring-results","targetKeyId":{"Fn::GetAtt":["ResultsBucketKey884312E0","Arn"]}}}}}}}},"ResultsBucket":{"id":"ResultsBucket","path":"AmiraLetterScoringStack/ResultsBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ResultsBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"bucketKeyEnabled":true,"serverSideEncryptionByDefault":{"sseAlgorithm":"aws:kms","kmsMasterKeyId":{"Fn::GetAtt":["ResultsBucketKey884312E0","Arn"]}}}]},"lifecycleConfiguration":{"rules":[{"id":"TransitionToIA","status":"Enabled","transitions":[{"storageClass":"STANDARD_IA","transitionInDays":30}]},{"id":"TransitionToGlacier","status":"Enabled","transitions":[{"storageClass":"GLACIER_IR","transitionInDays":120}]}]},"loggingConfiguration":{"destinationBucketName":{"Ref":"AccessLogsBucket83982689"},"logFilePrefix":"s3-access-logs/"},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true}}}},"Policy":{"id":"Policy","path":"AmiraLetterScoringStack/ResultsBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ResultsBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"ResultsBucketA95A2103"},"policyDocument":{"Statement":[{"Action":"s3:*","Condition":{"Bool":{"aws:SecureTransport":"false"}},"Effect":"Deny","Principal":{"AWS":"*"},"Resource":[{"Fn::GetAtt":["ResultsBucketA95A2103","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ResultsBucketA95A2103","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}}}},"JobsDLQ":{"id":"JobsDLQ","path":"AmiraLetterScoringStack/JobsDLQ","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/JobsDLQ/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"messageRetentionPeriod":1209600}}},"Policy":{"id":"Policy","path":"AmiraLetterScoringStack/JobsDLQ/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.QueuePolicy","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/JobsDLQ/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueuePolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::QueuePolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"sqs:*","Condition":{"Bool":{"aws:SecureTransport":"false"}},"Effect":"Deny","Principal":{"AWS":"*"},"Resource":{"Fn::GetAtt":["JobsDLQB327C2F8","Arn"]}}],"Version":"2012-10-17"},"queues":[{"Ref":"JobsDLQB327C2F8"}]}}}}}}},"JobsQueue":{"id":"JobsQueue","path":"AmiraLetterScoringStack/JobsQueue","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/JobsQueue/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"redrivePolicy":{"deadLetterTargetArn":{"Fn::GetAtt":["JobsDLQB327C2F8","Arn"]},"maxReceiveCount":3},"visibilityTimeout":900}}},"Policy":{"id":"Policy","path":"AmiraLetterScoringStack/JobsQueue/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.QueuePolicy","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/JobsQueue/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueuePolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::QueuePolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"sqs:*","Condition":{"Bool":{"aws:SecureTransport":"false"}},"Effect":"Deny","Principal":{"AWS":"*"},"Resource":{"Fn::GetAtt":["JobsQueue86ED6666","Arn"]}}],"Version":"2012-10-17"},"queues":[{"Ref":"JobsQueue86ED6666"}]}}}}}}},"TaskExecutionRole":{"id":"TaskExecutionRole","path":"AmiraLetterScoringStack/TaskExecutionRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.212.0","metadata":[]},"children":{"ImportTaskExecutionRole":{"id":"ImportTaskExecutionRole","path":"AmiraLetterScoringStack/TaskExecutionRole/ImportTaskExecutionRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/TaskExecutionRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ecs-tasks.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AmiraLetterScoringStack/TaskExecutionRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/TaskExecutionRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ecr:BatchCheckLayerAvailability","ecr:BatchGetImage","ecr:GetDownloadUrlForLayer"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["AmiraLetterScoringRepo09CE897F","Arn"]},{"Fn::GetAtt":["CloudWatchAgentRepo62FDA875","Arn"]},{"Fn::GetAtt":["DcgmExporterRepo96FE0342","Arn"]},{"Fn::GetAtt":["TritonServerRepoE954F487","Arn"]}]},{"Action":"ecr:GetAuthorizationToken","Effect":"Allow","Resource":"*"},{"Action":["logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":{"Fn::GetAtt":["AmiraLetterScoringLogGroupE17F4A17","Arn"]}},{"Action":["ssm:DescribeParameters","ssm:GetParameter","ssm:GetParameterHistory","ssm:GetParameters"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:aws:ssm:us-east-1:",{"Ref":"AWS::AccountId"},":parameter",{"Ref":"SsmBatchSize08BE5FB9"}]]},{"Fn::Join":["",["arn:aws:ssm:us-east-1:",{"Ref":"AWS::AccountId"},":parameter",{"Ref":"SsmConfidenceThreshold02D9E23D"}]]},{"Fn::Join":["",["arn:aws:ssm:us-east-1:",{"Ref":"AWS::AccountId"},":parameter",{"Ref":"SsmIncludeConfidence2FFA6A79"}]]},{"Fn::Join":["",["arn:aws:ssm:us-east-1:",{"Ref":"AWS::AccountId"},":parameter",{"Ref":"SsmModelPathD64BC4E2"}]]},{"Fn::Join":["",["arn:aws:ssm:us-east-1:",{"Ref":"AWS::AccountId"},":parameter",{"Ref":"SsmResultsPrefixFC1C636A"}]]}]}],"Version":"2012-10-17"},"policyName":"TaskExecutionRoleDefaultPolicyA84DD1B0","roles":[{"Ref":"TaskExecutionRole250D2532"}]}}}}}}},"TaskRole":{"id":"TaskRole","path":"AmiraLetterScoringStack/TaskRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.212.0","metadata":[]},"children":{"ImportTaskRole":{"id":"ImportTaskRole","path":"AmiraLetterScoringStack/TaskRole/ImportTaskRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/TaskRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ecs-tasks.amazonaws.com"}}],"Version":"2012-10-17"},"policies":[{"policyName":"S3Access","policyDocument":{"Statement":[{"Action":"s3:ListBucket","Effect":"Allow","Resource":{"Fn::GetAtt":["ResultsBucketA95A2103","Arn"]}},{"Action":"s3:PutObject","Effect":"Allow","Resource":{"Fn::Join":["",[{"Fn::GetAtt":["ResultsBucketA95A2103","Arn"]},"/*"]]}}],"Version":"2012-10-17"}},{"policyName":"SqsAccess","policyDocument":{"Statement":[{"Action":["sqs:DeleteMessage","sqs:GetQueueAttributes","sqs:ReceiveMessage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["JobsQueue86ED6666","Arn"]}}],"Version":"2012-10-17"}}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AmiraLetterScoringStack/TaskRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/TaskRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["kms:Decrypt","kms:Encrypt","kms:GenerateDataKey*","kms:ReEncrypt*"],"Effect":"Allow","Resource":{"Fn::GetAtt":["ResultsBucketKey884312E0","Arn"]}},{"Action":["ssm:DescribeParameters","ssm:GetParameter","ssm:GetParameterHistory","ssm:GetParameters"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:ssm:us-east-1:",{"Ref":"AWS::AccountId"},":parameter",{"Ref":"SsmCwAgentConfig5985118E"}]]}}],"Version":"2012-10-17"},"policyName":"TaskRoleDefaultPolicy07FC53DE","roles":[{"Ref":"TaskRole30FC0FBB"}]}}}}}}},"AudioBucketProvided":{"id":"AudioBucketProvided","path":"AmiraLetterScoringStack/AudioBucketProvided","constructInfo":{"fqn":"aws-cdk-lib.CfnCondition","version":"2.212.0"}},"TaskRoleAudioReadPolicy":{"id":"TaskRoleAudioReadPolicy","path":"AmiraLetterScoringStack/TaskRoleAudioReadPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/TaskRoleAudioReadPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"s3:ListBucket","Condition":{"StringLike":{"s3:prefix":[{"Ref":"AudioPrefix"}]}},"Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:s3:us-east-1:",{"Ref":"AWS::AccountId"},":",{"Ref":"AudioBucketName"}]]}},{"Action":"s3:GetObject","Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:s3:us-east-1:",{"Ref":"AWS::AccountId"},":",{"Ref":"AudioBucketName"},"/",{"Ref":"AudioPrefix"},"*"]]}}],"Version":"2012-10-17"},"policyName":"TaskRoleAudioReadPolicyB6B5E4C2","roles":[{"Ref":"TaskRole30FC0FBB"}]}}}}},"AmiraLetterScoringLogGroup":{"id":"AmiraLetterScoringLogGroup","path":"AmiraLetterScoringStack/AmiraLetterScoringLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":"/ecs/amira-letter-scoring","retentionInDays":7}}}}},"AmiraLetterScoringTaskDef":{"id":"AmiraLetterScoringTaskDef","path":"AmiraLetterScoringStack/AmiraLetterScoringTaskDef","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.Ec2TaskDefinition","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraLetterScoringTaskDef/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnTaskDefinition","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::TaskDefinition","aws:cdk:cloudformation:props":{"containerDefinitions":[{"command":["python","-m","src.pipeline.sqs_worker"],"cpu":2048,"dependsOn":[{"containerName":"TritonServerContainer","condition":"HEALTHY"}],"essential":true,"image":{"Fn::Join":["",[{"Fn::Select":[4,{"Fn::Split":[":",{"Fn::GetAtt":["AmiraLetterScoringRepo09CE897F","Arn"]}]}]},".dkr.ecr.",{"Fn::Select":[3,{"Fn::Split":[":",{"Fn::GetAtt":["AmiraLetterScoringRepo09CE897F","Arn"]}]}]},".",{"Ref":"AWS::URLSuffix"},"/",{"Ref":"AmiraLetterScoringRepo09CE897F"},":latest"]]},"memoryReservation":8192,"name":"AmiraLetterScoringContainer","ulimits":[{"name":"nofile","softLimit":65536,"hardLimit":65536}],"logConfiguration":{"logDriver":"awslogs","options":{"awslogs-group":{"Ref":"AmiraLetterScoringLogGroupE17F4A17"},"awslogs-stream-prefix":"amira-letter-scoring","awslogs-region":"us-east-1"}},"environment":[{"name":"PYTHONPATH","value":"/app"},{"name":"RESULTS_BUCKET","value":{"Ref":"ResultsBucketA95A2103"}},{"name":"JOBS_QUEUE_URL","value":{"Ref":"JobsQueue86ED6666"}},{"name":"AUDIO_DIR","value":{"Ref":"AudioDir"}},{"name":"USE_TRITON","value":"true"},{"name":"TRITON_URL","value":"http://127.0.0.1:8000"},{"name":"TRITON_MODEL","value":"w2v2"},{"name":"AWS_REGION","value":"us-east-1"}],"secrets":[{"name":"MODEL_PATH","valueFrom":{"Fn::Join":["",["arn:aws:ssm:us-east-1:",{"Ref":"AWS::AccountId"},":parameter",{"Ref":"SsmModelPathD64BC4E2"}]]}},{"name":"INCLUDE_CONFIDENCE","valueFrom":{"Fn::Join":["",["arn:aws:ssm:us-east-1:",{"Ref":"AWS::AccountId"},":parameter",{"Ref":"SsmIncludeConfidence2FFA6A79"}]]}},{"name":"RESULTS_PREFIX","valueFrom":{"Fn::Join":["",["arn:aws:ssm:us-east-1:",{"Ref":"AWS::AccountId"},":parameter",{"Ref":"SsmResultsPrefixFC1C636A"}]]}},{"name":"BATCH_SIZE","valueFrom":{"Fn::Join":["",["arn:aws:ssm:us-east-1:",{"Ref":"AWS::AccountId"},":parameter",{"Ref":"SsmBatchSize08BE5FB9"}]]}},{"name":"CONFIDENCE_THRESHOLD","valueFrom":{"Fn::Join":["",["arn:aws:ssm:us-east-1:",{"Ref":"AWS::AccountId"},":parameter",{"Ref":"SsmConfidenceThreshold02D9E23D"}]]}}]},{"cpu":1024,"essential":true,"image":{"Fn::Join":["",[{"Fn::Select":[4,{"Fn::Split":[":",{"Fn::GetAtt":["TritonServerRepoE954F487","Arn"]}]}]},".dkr.ecr.",{"Fn::Select":[3,{"Fn::Split":[":",{"Fn::GetAtt":["TritonServerRepoE954F487","Arn"]}]}]},".",{"Ref":"AWS::URLSuffix"},"/",{"Ref":"TritonServerRepoE954F487"},":latest"]]},"memoryReservation":4096,"name":"TritonServerContainer","portMappings":[{"containerPort":8000,"protocol":"tcp"},{"containerPort":8002,"protocol":"tcp"}],"ulimits":[{"name":"nofile","softLimit":65536,"hardLimit":65536}],"logConfiguration":{"logDriver":"awslogs","options":{"awslogs-group":{"Ref":"AmiraLetterScoringLogGroupE17F4A17"},"awslogs-stream-prefix":"triton-server","awslogs-region":"us-east-1"}},"environment":[{"name":"AWS_REGION","value":"us-east-1"}],"healthCheck":{"command":["CMD-SHELL","curl -sf http://127.0.0.1:8000/v2/health/ready || exit 1"],"interval":15,"retries":3,"startPeriod":30,"timeout":5},"resourceRequirements":[{"type":"GPU","value":"1"}]},{"cpu":128,"essential":true,"image":{"Fn::Join":["",[{"Fn::Select":[4,{"Fn::Split":[":",{"Fn::GetAtt":["DcgmExporterRepo96FE0342","Arn"]}]}]},".dkr.ecr.",{"Fn::Select":[3,{"Fn::Split":[":",{"Fn::GetAtt":["DcgmExporterRepo96FE0342","Arn"]}]}]},".",{"Ref":"AWS::URLSuffix"},"/",{"Ref":"DcgmExporterRepo96FE0342"},":latest"]]},"memoryReservation":256,"name":"DcgmExporterContainer","portMappings":[{"containerPort":9400,"protocol":"tcp"}],"logConfiguration":{"logDriver":"awslogs","options":{"awslogs-group":{"Ref":"AmiraLetterScoringLogGroupE17F4A17"},"awslogs-stream-prefix":"dcgm-exporter","awslogs-region":"us-east-1"}},"environment":[{"name":"AWS_REGION","value":"us-east-1"}]},{"command":["/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent","-a","fetch-config","-m","ec2","-c",{"Fn::Join":["",["ssm:",{"Ref":"SsmCwAgentConfig5985118E"}]]},"-s"],"cpu":128,"essential":true,"image":{"Fn::Join":["",[{"Fn::Select":[4,{"Fn::Split":[":",{"Fn::GetAtt":["CloudWatchAgentRepo62FDA875","Arn"]}]}]},".dkr.ecr.",{"Fn::Select":[3,{"Fn::Split":[":",{"Fn::GetAtt":["CloudWatchAgentRepo62FDA875","Arn"]}]}]},".",{"Ref":"AWS::URLSuffix"},"/",{"Ref":"CloudWatchAgentRepo62FDA875"},":latest"]]},"memoryReservation":256,"name":"CloudWatchAgentContainer","logConfiguration":{"logDriver":"awslogs","options":{"awslogs-group":{"Ref":"AmiraLetterScoringLogGroupE17F4A17"},"awslogs-stream-prefix":"cloudwatch-agent","awslogs-region":"us-east-1"}},"environment":[{"name":"AWS_REGION","value":"us-east-1"}]}],"executionRoleArn":{"Fn::GetAtt":["TaskExecutionRole250D2532","Arn"]},"family":"amira-letter-scoring","networkMode":"awsvpc","requiresCompatibilities":["EC2"],"taskRoleArn":{"Fn::GetAtt":["TaskRole30FC0FBB","Arn"]}}}},"AmiraLetterScoringContainer":{"id":"AmiraLetterScoringContainer","path":"AmiraLetterScoringStack/AmiraLetterScoringTaskDef/AmiraLetterScoringContainer","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.ContainerDefinition","version":"2.212.0"}},"TritonServerContainer":{"id":"TritonServerContainer","path":"AmiraLetterScoringStack/AmiraLetterScoringTaskDef/TritonServerContainer","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.ContainerDefinition","version":"2.212.0"}},"DcgmExporterContainer":{"id":"DcgmExporterContainer","path":"AmiraLetterScoringStack/AmiraLetterScoringTaskDef/DcgmExporterContainer","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.ContainerDefinition","version":"2.212.0"}},"CloudWatchAgentContainer":{"id":"CloudWatchAgentContainer","path":"AmiraLetterScoringStack/AmiraLetterScoringTaskDef/CloudWatchAgentContainer","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.ContainerDefinition","version":"2.212.0"}}}},"SsmModelPath":{"id":"SsmModelPath","path":"AmiraLetterScoringStack/SsmModelPath","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.StringParameter","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/SsmModelPath/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.CfnParameter","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSM::Parameter","aws:cdk:cloudformation:props":{"name":"/amira/model_path","type":"String","value":{"Ref":"ModelPath"}}}}}},"SsmIncludeConfidence":{"id":"SsmIncludeConfidence","path":"AmiraLetterScoringStack/SsmIncludeConfidence","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.StringParameter","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/SsmIncludeConfidence/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.CfnParameter","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSM::Parameter","aws:cdk:cloudformation:props":{"name":"/amira/include_confidence","type":"String","value":{"Ref":"IncludeConfidence"}}}}}},"SsmResultsPrefix":{"id":"SsmResultsPrefix","path":"AmiraLetterScoringStack/SsmResultsPrefix","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.StringParameter","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/SsmResultsPrefix/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.CfnParameter","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSM::Parameter","aws:cdk:cloudformation:props":{"name":"/amira/results_prefix","type":"String","value":{"Ref":"ResultsPrefix"}}}}}},"SsmBatchSize":{"id":"SsmBatchSize","path":"AmiraLetterScoringStack/SsmBatchSize","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.StringParameter","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/SsmBatchSize/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.CfnParameter","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSM::Parameter","aws:cdk:cloudformation:props":{"name":"/amira/batch_size","type":"String","value":"16"}}}}},"SsmConfidenceThreshold":{"id":"SsmConfidenceThreshold","path":"AmiraLetterScoringStack/SsmConfidenceThreshold","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.StringParameter","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/SsmConfidenceThreshold/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.CfnParameter","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSM::Parameter","aws:cdk:cloudformation:props":{"name":"/amira/confidence_threshold","type":"String","value":"0.6"}}}}},"SsmCwAgentConfig":{"id":"SsmCwAgentConfig","path":"AmiraLetterScoringStack/SsmCwAgentConfig","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.StringParameter","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/SsmCwAgentConfig/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.CfnParameter","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSM::Parameter","aws:cdk:cloudformation:props":{"name":"/amira/cwagent_config","type":"String","value":"{\"agent\":{\"debug\":false},\"metrics\":{\"namespace\":\"CWAgent\",\"metrics_collected\":{\"prometheus\":{\"emf_processor\":{\"metric_declaration\":[{\"source_labels\":[\"__name__\"],\"label_matcher\":\"^DCGM_FI_DEV_GPU_UTIL$\",\"dimensions\":[[\"gpu\"]],\"metric_selectors\":[\"^DCGM_FI_DEV_GPU_UTIL$\"]},{\"source_labels\":[\"__name__\"],\"label_matcher\":\"^DCGM_FI_DEV_FB_USED$\",\"dimensions\":[[\"gpu\"]],\"metric_selectors\":[\"^DCGM_FI_DEV_FB_USED$\"]},{\"source_labels\":[\"__name__\"],\"label_matcher\":\"^DCGM_FI_DEV_FB_TOTAL$\",\"dimensions\":[[\"gpu\"]],\"metric_selectors\":[\"^DCGM_FI_DEV_FB_TOTAL$\"]},{\"source_labels\":[\"__name__\",\"quantile\"],\"label_matcher\":\"^nv_inference_request_duration_us;0.95$\",\"dimensions\":[[\"model\"]],\"metric_selectors\":[\"^nv_inference_request_duration_us$\"]},{\"source_labels\":[\"__name__\",\"quantile\"],\"label_matcher\":\"^nv_inference_queue_duration_us;0.95$\",\"dimensions\":[[\"model\"]],\"metric_selectors\":[\"^nv_inference_queue_duration_us$\"]},{\"source_labels\":[\"__name__\"],\"label_matcher\":\"^nv_inference_count$\",\"dimensions\":[[\"model\"]],\"metric_selectors\":[\"^nv_inference_count$\"]},{\"source_labels\":[\"__name__\"],\"label_matcher\":\"^nv_inference_fail$\",\"dimensions\":[[\"model\"]],\"metric_selectors\":[\"^nv_inference_fail$\"]}]},\"metrics_declaration\":[],\"scrape_interval\":\"15s\",\"static_targets\":[{\"targets\":[\"127.0.0.1:9400\",\"127.0.0.1:8002\"]}]}}}}"}}}}},"AmiraLetterScoringService":{"id":"AmiraLetterScoringService","path":"AmiraLetterScoringStack/AmiraLetterScoringService","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.Ec2Service","version":"2.212.0","metadata":[]},"children":{"Service":{"id":"Service","path":"AmiraLetterScoringStack/AmiraLetterScoringService/Service","constructInfo":{"fqn":"aws-cdk-lib.aws_ecs.CfnService","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECS::Service","aws:cdk:cloudformation:props":{"capacityProviderStrategy":[{"capacityProvider":{"Ref":"GpuCapacityProvider4F6714BE"},"weight":1},{"capacityProvider":{"Ref":"GpuCapacityProviderG5xlargeD25A2496"},"weight":1},{"capacityProvider":{"Ref":"GpuCapacityProviderG52xlarge96802DE0"},"weight":1}],"cluster":{"Ref":"AmiraLetterScoringCluster5CE0BCC9"},"deploymentConfiguration":{"maximumPercent":200,"minimumHealthyPercent":100,"alarms":{"alarmNames":[],"enable":false,"rollback":false}},"desiredCount":0,"enableEcsManagedTags":false,"networkConfiguration":{"awsvpcConfiguration":{"assignPublicIp":"DISABLED","subnets":[{"Ref":"AmiraLetterScoringVpcPrivateSubnet1SubnetAFBD66CD"},{"Ref":"AmiraLetterScoringVpcPrivateSubnet2Subnet12E38A78"}],"securityGroups":[{"Fn::GetAtt":["AmiraLetterScoringSecurityGroup645D2D92","GroupId"]}]}},"placementStrategies":[{"type":"spread","field":"instanceId"}],"schedulingStrategy":"REPLICA","serviceName":"amira-letter-scoring-service","taskDefinition":{"Ref":"AmiraLetterScoringTaskDef0B418B7C"}}}}}},"ServiceScalableTarget":{"id":"ServiceScalableTarget","path":"AmiraLetterScoringStack/ServiceScalableTarget","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.ScalableTarget","version":"2.212.0","metadata":[]},"children":{"Role":{"id":"Role","path":"AmiraLetterScoringStack/ServiceScalableTarget/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.212.0","metadata":[]},"children":{"ImportRole":{"id":"ImportRole","path":"AmiraLetterScoringStack/ServiceScalableTarget/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ServiceScalableTarget/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"application-autoscaling.amazonaws.com"}}],"Version":"2012-10-17"}}}}}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ServiceScalableTarget/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.CfnScalableTarget","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApplicationAutoScaling::ScalableTarget","aws:cdk:cloudformation:props":{"maxCapacity":50,"minCapacity":0,"resourceId":{"Fn::Join":["",["service/",{"Ref":"AmiraLetterScoringCluster5CE0BCC9"},"/",{"Fn::GetAtt":["AmiraLetterScoringService1F7D59D0","Name"]}]]},"roleArn":{"Fn::GetAtt":["ServiceScalableTargetRole431DE458","Arn"]},"scalableDimension":"ecs:service:DesiredCount","serviceNamespace":"ecs"}}}}},"ScaleOutOnQueueDepth":{"id":"ScaleOutOnQueueDepth","path":"AmiraLetterScoringStack/ScaleOutOnQueueDepth","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.StepScalingPolicy","version":"2.212.0"},"children":{"UpperPolicy":{"id":"UpperPolicy","path":"AmiraLetterScoringStack/ScaleOutOnQueueDepth/UpperPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.StepScalingAction","version":"2.212.0"},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ScaleOutOnQueueDepth/UpperPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.CfnScalingPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApplicationAutoScaling::ScalingPolicy","aws:cdk:cloudformation:props":{"policyName":"AmiraLetterScoringStackScaleOutOnQueueDepthUpperPolicy47EB0C82","policyType":"StepScaling","scalingTargetId":{"Ref":"ServiceScalableTarget2D63BDF8"},"stepScalingPolicyConfiguration":{"adjustmentType":"ChangeInCapacity","cooldown":120,"metricAggregationType":"Average","stepAdjustments":[{"metricIntervalLowerBound":0,"metricIntervalUpperBound":990,"scalingAdjustment":5},{"metricIntervalLowerBound":990,"scalingAdjustment":10}]}}}}}},"UpperAlarm":{"id":"UpperAlarm","path":"AmiraLetterScoringStack/ScaleOutOnQueueDepth/UpperAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ScaleOutOnQueueDepth/UpperAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"ScaleOutOnQueueDepthUpperPolicyD06055FC"}],"alarmDescription":"Upper threshold scaling alarm","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"QueueName","value":{"Fn::GetAtt":["JobsQueue86ED6666","QueueName"]}}],"evaluationPeriods":1,"metricName":"ApproximateNumberOfMessagesVisible","namespace":"AWS/SQS","period":60,"statistic":"Average","threshold":10}}}}}}},"ScaleInOnQueueDepth":{"id":"ScaleInOnQueueDepth","path":"AmiraLetterScoringStack/ScaleInOnQueueDepth","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.StepScalingPolicy","version":"2.212.0"},"children":{"LowerPolicy":{"id":"LowerPolicy","path":"AmiraLetterScoringStack/ScaleInOnQueueDepth/LowerPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.StepScalingAction","version":"2.212.0"},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ScaleInOnQueueDepth/LowerPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.CfnScalingPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApplicationAutoScaling::ScalingPolicy","aws:cdk:cloudformation:props":{"policyName":"AmiraLetterScoringStackScaleInOnQueueDepthLowerPolicy67B6E3DF","policyType":"StepScaling","scalingTargetId":{"Ref":"ServiceScalableTarget2D63BDF8"},"stepScalingPolicyConfiguration":{"adjustmentType":"ChangeInCapacity","cooldown":300,"metricAggregationType":"Average","stepAdjustments":[{"metricIntervalLowerBound":-4,"metricIntervalUpperBound":0,"scalingAdjustment":-2},{"metricIntervalUpperBound":-4,"scalingAdjustment":-3}]}}}}}},"LowerAlarm":{"id":"LowerAlarm","path":"AmiraLetterScoringStack/ScaleInOnQueueDepth/LowerAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ScaleInOnQueueDepth/LowerAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"ScaleInOnQueueDepthLowerPolicyF63295ED"}],"alarmDescription":"Lower threshold scaling alarm","comparisonOperator":"LessThanOrEqualToThreshold","dimensions":[{"name":"QueueName","value":{"Fn::GetAtt":["JobsQueue86ED6666","QueueName"]}}],"evaluationPeriods":1,"metricName":"ApproximateNumberOfMessagesVisible","namespace":"AWS/SQS","period":60,"statistic":"Average","threshold":5}}}}}}},"ScaleOutOnOldestAge":{"id":"ScaleOutOnOldestAge","path":"AmiraLetterScoringStack/ScaleOutOnOldestAge","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.StepScalingPolicy","version":"2.212.0"},"children":{"UpperPolicy":{"id":"UpperPolicy","path":"AmiraLetterScoringStack/ScaleOutOnOldestAge/UpperPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.StepScalingAction","version":"2.212.0"},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ScaleOutOnOldestAge/UpperPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_applicationautoscaling.CfnScalingPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApplicationAutoScaling::ScalingPolicy","aws:cdk:cloudformation:props":{"policyName":"AmiraLetterScoringStackScaleOutOnOldestAgeUpperPolicy30D4BBB9","policyType":"StepScaling","scalingTargetId":{"Ref":"ServiceScalableTarget2D63BDF8"},"stepScalingPolicyConfiguration":{"adjustmentType":"ChangeInCapacity","cooldown":60,"metricAggregationType":"Average","stepAdjustments":[{"metricIntervalLowerBound":0,"metricIntervalUpperBound":600,"scalingAdjustment":5},{"metricIntervalLowerBound":600,"scalingAdjustment":10}]}}}}}},"UpperAlarm":{"id":"UpperAlarm","path":"AmiraLetterScoringStack/ScaleOutOnOldestAge/UpperAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ScaleOutOnOldestAge/UpperAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"ScaleOutOnOldestAgeUpperPolicy16B1CFBB"}],"alarmDescription":"Upper threshold scaling alarm","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"QueueName","value":{"Fn::GetAtt":["JobsQueue86ED6666","QueueName"]}}],"evaluationPeriods":1,"metricName":"ApproximateAgeOfOldestMessage","namespace":"AWS/SQS","period":60,"statistic":"Average","threshold":300}}}}}}},"EnqueueJobsFunction":{"id":"EnqueueJobsFunction","path":"AmiraLetterScoringStack/EnqueueJobsFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.212.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AmiraLetterScoringStack/EnqueueJobsFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.212.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AmiraLetterScoringStack/EnqueueJobsFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/EnqueueJobsFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AmiraLetterScoringStack/EnqueueJobsFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/EnqueueJobsFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["athena:GetQueryExecution","athena:GetQueryResults","athena:StartQueryExecution"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:athena:us-east-1:",{"Ref":"AWS::AccountId"},":workgroup/primary"]]}},{"Action":"glue:GetDatabase","Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:glue:us-east-1:",{"Ref":"AWS::AccountId"},":database/",{"Ref":"AthenaDatabase"}]]}},{"Action":"glue:GetTable","Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:glue:us-east-1:",{"Ref":"AWS::AccountId"},":table/",{"Ref":"AthenaDatabase"},"/*"]]}},{"Action":"s3:ListBucket","Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:s3:us-east-1:",{"Ref":"AWS::AccountId"},":",{"Fn::Select":[2,{"Fn::Split":["/",{"Ref":"AthenaOutput"}]}]}]]}},{"Action":["s3:GetObject","s3:PutObject"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:s3:us-east-1:",{"Ref":"AWS::AccountId"},":",{"Fn::Select":[2,{"Fn::Split":["/",{"Ref":"AthenaOutput"}]}]},"/",{"Fn::Join":["/",[{"Fn::Select":[3,{"Fn::Split":["/",{"Ref":"AthenaOutput"}]}]},{"Fn::Select":[4,{"Fn::Split":["/",{"Ref":"AthenaOutput"}]}]}]]},"/*"]]}},{"Action":["sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:SendMessage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["JobsQueue86ED6666","Arn"]}}],"Version":"2012-10-17"},"policyName":"EnqueueJobsFunctionServiceRoleDefaultPolicy05D31F48","roles":[{"Ref":"EnqueueJobsFunctionServiceRole7BD4867E"}]}}}}}}},"Code":{"id":"Code","path":"AmiraLetterScoringStack/EnqueueJobsFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.212.0"},"children":{"Stage":{"id":"Stage","path":"AmiraLetterScoringStack/EnqueueJobsFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.212.0"}},"AssetBucket":{"id":"AssetBucket","path":"AmiraLetterScoringStack/EnqueueJobsFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.212.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/EnqueueJobsFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":{"Fn::Sub":"cdk-hnb659fds-assets-${AWS::AccountId}-us-east-1"},"s3Key":"a6ce06348d9dcb5f2b3aa8b4b39a92cc276f0dbf1313a61ea2fbfabc3284f887.zip"},"environment":{"variables":{"JOBS_QUEUE_URL":{"Ref":"JobsQueue86ED6666"},"ATHENA_DATABASE":{"Ref":"AthenaDatabase"},"ATHENA_OUTPUT":{"Ref":"AthenaOutput"},"ATHENA_QUERY":{"Ref":"AthenaQuery"}}},"handler":"index.handler","role":{"Fn::GetAtt":["EnqueueJobsFunctionServiceRole7BD4867E","Arn"]},"runtime":"python3.12","timeout":300}}}}},"NightlyScheduleRule":{"id":"NightlyScheduleRule","path":"AmiraLetterScoringStack/NightlyScheduleRule","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Rule","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/NightlyScheduleRule/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnRule","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Rule","aws:cdk:cloudformation:props":{"description":"Enqueue nightly jobs at 2 AM UTC","scheduleExpression":"cron(0 2 * * ? *)","state":"ENABLED","targets":[{"id":"Target0","arn":{"Fn::GetAtt":["EnqueueJobsFunction32F0B2E2","Arn"]}}]}}},"AllowEventRuleAmiraLetterScoringStackEnqueueJobsFunction2B4ACB2A":{"id":"AllowEventRuleAmiraLetterScoringStackEnqueueJobsFunction2B4ACB2A","path":"AmiraLetterScoringStack/NightlyScheduleRule/AllowEventRuleAmiraLetterScoringStackEnqueueJobsFunction2B4ACB2A","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["EnqueueJobsFunction32F0B2E2","Arn"]},"principal":"events.amazonaws.com","sourceArn":{"Fn::GetAtt":["NightlyScheduleRule901B3B59","Arn"]}}}}}},"PrescaleMain":{"id":"PrescaleMain","path":"AmiraLetterScoringStack/PrescaleMain","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.CfnScheduledAction","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AutoScaling::ScheduledAction","aws:cdk:cloudformation:props":{"autoScalingGroupName":{"Ref":"GpuAutoScalingGroupASG98F60F09"},"desiredCapacity":1,"recurrence":"55 1 * * *"}}},"PrescaleG5x":{"id":"PrescaleG5x","path":"AmiraLetterScoringStack/PrescaleG5x","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.CfnScheduledAction","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AutoScaling::ScheduledAction","aws:cdk:cloudformation:props":{"autoScalingGroupName":{"Ref":"GpuAsgG5xlargeASG242F426D"},"desiredCapacity":1,"recurrence":"55 1 * * *"}}},"PrescaleG52x":{"id":"PrescaleG52x","path":"AmiraLetterScoringStack/PrescaleG52x","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.CfnScheduledAction","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AutoScaling::ScheduledAction","aws:cdk:cloudformation:props":{"autoScalingGroupName":{"Ref":"GpuAsgG52xlargeASG1CBA2EF7"},"desiredCapacity":1,"recurrence":"55 1 * * *"}}},"ScaleDownMain":{"id":"ScaleDownMain","path":"AmiraLetterScoringStack/ScaleDownMain","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.CfnScheduledAction","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AutoScaling::ScheduledAction","aws:cdk:cloudformation:props":{"autoScalingGroupName":{"Ref":"GpuAutoScalingGroupASG98F60F09"},"desiredCapacity":0,"recurrence":"30 3 * * *"}}},"ScaleDownG5x":{"id":"ScaleDownG5x","path":"AmiraLetterScoringStack/ScaleDownG5x","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.CfnScheduledAction","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AutoScaling::ScheduledAction","aws:cdk:cloudformation:props":{"autoScalingGroupName":{"Ref":"GpuAsgG5xlargeASG242F426D"},"desiredCapacity":0,"recurrence":"30 3 * * *"}}},"ScaleDownG52x":{"id":"ScaleDownG52x","path":"AmiraLetterScoringStack/ScaleDownG52x","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.CfnScheduledAction","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AutoScaling::ScheduledAction","aws:cdk:cloudformation:props":{"autoScalingGroupName":{"Ref":"GpuAsgG52xlargeASG1CBA2EF7"},"desiredCapacity":0,"recurrence":"30 3 * * *"}}},"QueueOldestAgeAlarm":{"id":"QueueOldestAgeAlarm","path":"AmiraLetterScoringStack/QueueOldestAgeAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/QueueOldestAgeAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OpsAlarmTopic795165FB"}],"comparisonOperator":"GreaterThanThreshold","dimensions":[{"name":"QueueName","value":{"Fn::GetAtt":["JobsQueue86ED6666","QueueName"]}}],"evaluationPeriods":3,"metricName":"ApproximateAgeOfOldestMessage","namespace":"AWS/SQS","period":60,"statistic":"Average","threshold":900}}}}},"DLQDepthAlarm":{"id":"DLQDepthAlarm","path":"AmiraLetterScoringStack/DLQDepthAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/DLQDepthAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OpsAlarmTopic795165FB"}],"comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"QueueName","value":{"Fn::GetAtt":["JobsDLQB327C2F8","QueueName"]}}],"evaluationPeriods":1,"metricName":"ApproximateNumberOfMessagesVisible","namespace":"AWS/SQS","period":60,"statistic":"Sum","threshold":1}}}}},"OpsAlarmTopic":{"id":"OpsAlarmTopic","path":"AmiraLetterScoringStack/OpsAlarmTopic","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/OpsAlarmTopic/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{"displayName":"Amira Letter Scoring Alarms"}}}}},"AlarmEmail":{"id":"AlarmEmail","path":"AmiraLetterScoringStack/AlarmEmail","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"AlarmEmailProvided":{"id":"AlarmEmailProvided","path":"AmiraLetterScoringStack/AlarmEmailProvided","constructInfo":{"fqn":"aws-cdk-lib.CfnCondition","version":"2.212.0"}},"OpsAlarmEmailSubscription":{"id":"OpsAlarmEmailSubscription","path":"AmiraLetterScoringStack/OpsAlarmEmailSubscription","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnSubscription","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Subscription","aws:cdk:cloudformation:props":{"endpoint":{"Ref":"AlarmEmail"},"protocol":"email","topicArn":{"Ref":"OpsAlarmTopic795165FB"}}}},"ManualEnqueueFunction":{"id":"ManualEnqueueFunction","path":"AmiraLetterScoringStack/ManualEnqueueFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.212.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AmiraLetterScoringStack/ManualEnqueueFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.212.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AmiraLetterScoringStack/ManualEnqueueFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ManualEnqueueFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AmiraLetterScoringStack/ManualEnqueueFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ManualEnqueueFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:SendMessage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["JobsQueue86ED6666","Arn"]}}],"Version":"2012-10-17"},"policyName":"ManualEnqueueFunctionServiceRoleDefaultPolicyD2620B86","roles":[{"Ref":"ManualEnqueueFunctionServiceRole52A6FC21"}]}}}}}}},"Code":{"id":"Code","path":"AmiraLetterScoringStack/ManualEnqueueFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.212.0"},"children":{"Stage":{"id":"Stage","path":"AmiraLetterScoringStack/ManualEnqueueFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.212.0"}},"AssetBucket":{"id":"AssetBucket","path":"AmiraLetterScoringStack/ManualEnqueueFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.212.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ManualEnqueueFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":{"Fn::Sub":"cdk-hnb659fds-assets-${AWS::AccountId}-us-east-1"},"s3Key":"29697d8de172de721e9c4fb119739539966b20f001868ff346d3804c9d31b677.zip"},"environment":{"variables":{"JOBS_QUEUE_URL":{"Ref":"JobsQueue86ED6666"}}},"handler":"index.handler","role":{"Fn::GetAtt":["ManualEnqueueFunctionServiceRole52A6FC21","Arn"]},"runtime":"python3.12","timeout":60}}},"FunctionUrl":{"id":"FunctionUrl","path":"AmiraLetterScoringStack/ManualEnqueueFunction/FunctionUrl","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.FunctionUrl","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/ManualEnqueueFunction/FunctionUrl/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnUrl","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Url","aws:cdk:cloudformation:props":{"authType":"AWS_IAM","cors":{"allowMethods":["POST","OPTIONS"],"allowOrigins":["*"]},"targetFunctionArn":{"Fn::GetAtt":["ManualEnqueueFunction7DB3F605","Arn"]}}}}}}}},"GpuUtilLow":{"id":"GpuUtilLow","path":"AmiraLetterScoringStack/GpuUtilLow","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/GpuUtilLow/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OpsAlarmTopic795165FB"}],"comparisonOperator":"LessThanThreshold","evaluationPeriods":5,"metricName":"DCGM_FI_DEV_GPU_UTIL","namespace":"CWAgent","period":60,"statistic":"Average","threshold":20}}}}},"GpuUtilHigh":{"id":"GpuUtilHigh","path":"AmiraLetterScoringStack/GpuUtilHigh","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/GpuUtilHigh/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OpsAlarmTopic795165FB"}],"comparisonOperator":"GreaterThanThreshold","evaluationPeriods":3,"metricName":"DCGM_FI_DEV_GPU_UTIL","namespace":"CWAgent","period":60,"statistic":"Average","threshold":95}}}}},"TritonLatencyHigh":{"id":"TritonLatencyHigh","path":"AmiraLetterScoringStack/TritonLatencyHigh","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/TritonLatencyHigh/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OpsAlarmTopic795165FB"}],"comparisonOperator":"GreaterThanThreshold","evaluationPeriods":5,"extendedStatistic":"p95","metricName":"nv_inference_request_duration_us","namespace":"CWAgent","period":60,"threshold":500000}}}}},"TritonQueueLatencyHigh":{"id":"TritonQueueLatencyHigh","path":"AmiraLetterScoringStack/TritonQueueLatencyHigh","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/TritonQueueLatencyHigh/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OpsAlarmTopic795165FB"}],"comparisonOperator":"GreaterThanThreshold","evaluationPeriods":5,"extendedStatistic":"p95","metricName":"nv_inference_queue_duration_us","namespace":"CWAgent","period":60,"threshold":200000}}}}},"TritonFailuresHigh":{"id":"TritonFailuresHigh","path":"AmiraLetterScoringStack/TritonFailuresHigh","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/TritonFailuresHigh/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OpsAlarmTopic795165FB"}],"comparisonOperator":"GreaterThanOrEqualToThreshold","evaluationPeriods":1,"metricName":"nv_inference_fail","namespace":"CWAgent","period":60,"statistic":"Sum","threshold":1}}}}},"AmiraGpuTritonDashboard":{"id":"AmiraGpuTritonDashboard","path":"AmiraLetterScoringStack/AmiraGpuTritonDashboard","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Dashboard","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/AmiraGpuTritonDashboard/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnDashboard","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Dashboard","aws:cdk:cloudformation:props":{"dashboardBody":{"Fn::Join":["",["{\"widgets\":[{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":0,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"GPU Utilization\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"CWAgent\",\"DCGM_FI_DEV_GPU_UTIL\",{\"period\":60}]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":12,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Triton p95 Latency (us)\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"CWAgent\",\"nv_inference_request_duration_us\",{\"period\":60,\"stat\":\"p95\"}]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":0,\"y\":6,\"properties\":{\"view\":\"timeSeries\",\"title\":\"GPU Memory (bytes)\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"CWAgent\",\"DCGM_FI_DEV_FB_USED\",{\"period\":60}],[\"CWAgent\",\"DCGM_FI_DEV_FB_TOTAL\",{\"period\":60}]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":12,\"y\":6,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Triton Queue p95 (us)\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"CWAgent\",\"nv_inference_queue_duration_us\",{\"period\":60,\"stat\":\"p95\"}]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":24,\"height\":6,\"x\":0,\"y\":12,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Triton Throughput (req/min) & Failures\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"CWAgent\",\"nv_inference_count\",{\"period\":60,\"stat\":\"Sum\"}],[\"CWAgent\",\"nv_inference_fail\",{\"period\":60,\"stat\":\"Sum\",\"yAxis\":\"right\"}]],\"yAxis\":{}}}]}"]]},"dashboardName":"AmiraGpuTriton"}}}}},"EcsDrainOnSpotFn":{"id":"EcsDrainOnSpotFn","path":"AmiraLetterScoringStack/EcsDrainOnSpotFn","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.212.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AmiraLetterScoringStack/EcsDrainOnSpotFn/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.212.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AmiraLetterScoringStack/EcsDrainOnSpotFn/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.212.0","metadata":[]}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/EcsDrainOnSpotFn/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AmiraLetterScoringStack/EcsDrainOnSpotFn/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/EcsDrainOnSpotFn/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ecs:DescribeContainerInstances","ecs:ListContainerInstances","ecs:UpdateContainerInstancesState"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["AmiraLetterScoringCluster5CE0BCC9","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["AmiraLetterScoringCluster5CE0BCC9","Arn"]},"/*"]]}]}],"Version":"2012-10-17"},"policyName":"EcsDrainOnSpotFnServiceRoleDefaultPolicyD890DE6B","roles":[{"Ref":"EcsDrainOnSpotFnServiceRole040F4323"}]}}}}}}},"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/EcsDrainOnSpotFn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"import os\nimport boto3\n\necs = boto3.client('ecs')\ncluster_arn = os.environ.get('CLUSTER_ARN')\n\ndef handler(event, context):\n    detail = event.get('detail', {})\n    instance_id = detail.get('instance-id') or detail.get('EC2InstanceId')\n    if not instance_id:\n        return {'status': 'no-instance-id'}\n    next_token = None\n    container_instance_arn = None\n    while True:\n        kwargs = {'cluster': cluster_arn}\n        if next_token:\n            kwargs['nextToken'] = next_token\n        resp = ecs.list_container_instances(**kwargs)\n        if not resp.get('containerInstanceArns'):\n            break\n        desc = ecs.describe_container_instances(cluster=cluster_arn, containerInstances=resp['containerInstanceArns'])\n        for ci in desc.get('containerInstances', []):\n            if ci.get('ec2InstanceId') == instance_id:\n                container_instance_arn = ci.get('containerInstanceArn')\n                break\n        if container_instance_arn:\n            break\n        next_token = resp.get('nextToken')\n        if not next_token:\n            break\n    if not container_instance_arn:\n        return {'status': 'no-container-instance'}\n    ecs.update_container_instances_state(cluster=cluster_arn, containerInstances=[container_instance_arn], status='DRAINING')\n    return {'status': 'draining', 'containerInstanceArn': container_instance_arn}\n"},"environment":{"variables":{"CLUSTER_ARN":{"Fn::GetAtt":["AmiraLetterScoringCluster5CE0BCC9","Arn"]}}},"handler":"index.handler","role":{"Fn::GetAtt":["EcsDrainOnSpotFnServiceRole040F4323","Arn"]},"runtime":"python3.12","timeout":60}}}}},"SpotInterruptionDrainRule":{"id":"SpotInterruptionDrainRule","path":"AmiraLetterScoringStack/SpotInterruptionDrainRule","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Rule","version":"2.212.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AmiraLetterScoringStack/SpotInterruptionDrainRule/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnRule","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Rule","aws:cdk:cloudformation:props":{"description":"Drain ECS container instances on Spot interruption warnings","eventPattern":{"source":["aws.ec2"],"detail-type":["EC2 Spot Instance Interruption Warning","EC2 Instance Rebalance Recommendation"]},"state":"ENABLED","targets":[{"id":"Target0","arn":{"Fn::GetAtt":["EcsDrainOnSpotFn176764FB","Arn"]}}]}}},"AllowEventRuleAmiraLetterScoringStackEcsDrainOnSpotFn6C2F515E":{"id":"AllowEventRuleAmiraLetterScoringStackEcsDrainOnSpotFn6C2F515E","path":"AmiraLetterScoringStack/SpotInterruptionDrainRule/AllowEventRuleAmiraLetterScoringStackEcsDrainOnSpotFn6C2F515E","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.212.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["EcsDrainOnSpotFn176764FB","Arn"]},"principal":"events.amazonaws.com","sourceArn":{"Fn::GetAtt":["SpotInterruptionDrainRule9F64F2D1","Arn"]}}}}}},"RepositoryUri":{"id":"RepositoryUri","path":"AmiraLetterScoringStack/RepositoryUri","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.212.0"}},"ClusterName":{"id":"ClusterName","path":"AmiraLetterScoringStack/ClusterName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.212.0"}},"ServiceName":{"id":"ServiceName","path":"AmiraLetterScoringStack/ServiceName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.212.0"}},"JobsQueueUrl":{"id":"JobsQueueUrl","path":"AmiraLetterScoringStack/JobsQueueUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.212.0"}},"ResultsBucketName":{"id":"ResultsBucketName","path":"AmiraLetterScoringStack/ResultsBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.212.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"AmiraLetterScoringStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"AmiraLetterScoringStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.212.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"AmiraLetterScoringStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.212.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"AmiraLetterScoringStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.212.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}